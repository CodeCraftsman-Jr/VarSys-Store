<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VarSys Apps - Download Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.1"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .app-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .app-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        .version-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold text-gray-800 mb-4">
                <i class="fas fa-mobile-alt text-indigo-600"></i> VarSys Apps
            </h1>
            <p class="text-xl text-gray-600">Download the latest versions of our mobile applications</p>
        </header>

        <!-- Loading State -->
        <div id="loading" class="text-center py-12">
            <i class="fas fa-spinner fa-spin text-4xl text-indigo-600"></i>
            <p class="mt-4 text-gray-600">Loading available updates...</p>
        </div>

        <!-- Apps Grid -->
        <div id="apps-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 hidden">
            <!-- App cards will be inserted here dynamically -->
        </div>

        <!-- No Updates Message -->
        <div id="no-updates" class="text-center py-12 hidden">
            <i class="fas fa-inbox text-6xl text-gray-400 mb-4"></i>
            <p class="text-xl text-gray-600">No updates available at this time</p>
        </div>

        <!-- Footer -->
        <footer class="mt-16 text-center text-gray-600">
            <p>&copy; 2024 VarSys. All rights reserved.</p>
            <p class="mt-2 text-sm">
                <a href="#" class="text-indigo-600 hover:underline">Privacy Policy</a> | 
                <a href="#" class="text-indigo-600 hover:underline">Terms of Service</a>
            </a>
        </footer>
    </div>

    <script>
        // Appwrite Configuration (Cloud)
        const ENDPOINT = 'https://cloud.appwrite.io/v1';
        const PROJECT_ID = '692edd5d002346df067e';
        const DATABASE_ID = 'traqify_db';
        const COLLECTION_ID = 'app_updates';

        const client = new Appwrite.Client()
            .setEndpoint(ENDPOINT)
            .setProject(PROJECT_ID);

        const databases = new Appwrite.Databases(client);

        // App metadata with icons and descriptions
        const appMetadata = {
            'Joint Journey Mobile': {
                icon: 'fa-handshake',
                color: 'blue',
                description: 'Comprehensive personal finance and fitness tracking',
                tagline: 'Your Journey to Financial and Physical Wellness'
            },
            'CookSuite Mobile': {
                icon: 'fa-utensils',
                color: 'orange',
                description: 'Kitchen management and recipe organization',
                tagline: 'Master Your Kitchen, One Recipe at a Time'
            },
            'TraQify Mobile': {
                icon: 'fa-chart-line',
                color: 'green',
                description: 'Advanced analytics and tracking solutions',
                tagline: 'Track, Analyze, Optimize Your Life'
            },
            'Joint Journey Desktop': {
                icon: 'fa-desktop',
                color: 'blue',
                description: 'Desktop version for Windows',
                tagline: 'Full-featured desktop experience'
            },
            'CookSuite Desktop': {
                icon: 'fa-desktop',
                color: 'orange',
                description: 'Desktop version for Windows',
                tagline: 'Full-featured desktop experience'
            },
            'TraQify Desktop': {
                icon: 'fa-desktop',
                color: 'green',
                description: 'Desktop version for Windows',
                tagline: 'Full-featured desktop experience'
            }
        };

        // Fetch and display updates
        async function loadUpdates() {
            try {
                const response = await databases.listDocuments(
                    DATABASE_ID,
                    COLLECTION_ID,
                    [
                        Appwrite.Query.equal('is_active', true),
                        Appwrite.Query.orderDesc('released_at'),
                        Appwrite.Query.limit(100)
                    ]
                );

                const loading = document.getElementById('loading');
                const container = document.getElementById('apps-container');
                const noUpdates = document.getElementById('no-updates');

                loading.classList.add('hidden');

                if (response.documents.length === 0) {
                    noUpdates.classList.remove('hidden');
                    return;
                }

                // Group updates by app name and get latest version
                const latestUpdates = {};
                response.documents.forEach(doc => {
                    if (!latestUpdates[doc.app_name] || doc.version_code > latestUpdates[doc.app_name].version_code) {
                        latestUpdates[doc.app_name] = doc;
                    }
                });

                // Display app cards
                container.classList.remove('hidden');
                Object.values(latestUpdates).forEach(app => {
                    const metadata = appMetadata[app.app_name] || {
                        icon: 'fa-mobile-alt',
                        color: 'gray',
                        description: 'Mobile application',
                        tagline: 'Download the latest version'
                    };

                    const card = createAppCard(app, metadata);
                    container.innerHTML += card;
                });

            } catch (error) {
                console.error('Error loading updates:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="text-red-600">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                        <p class="text-xl">Failed to load updates</p>
                        <p class="text-sm mt-2">${error.message}</p>
                    </div>
                `;
            }
        }

        function createAppCard(app, metadata) {
            const fileSizeMB = (app.file_size / 1024 / 1024).toFixed(2);
            const releaseDate = new Date(app.released_at).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const platformIcon = app.platform === 'android' ? 'fa-android' : 
                                 app.platform === 'ios' ? 'fa-apple' : 
                                 app.platform === 'windows' ? 'fa-windows' : 'fa-desktop';

            const mandatoryBadge = app.is_mandatory ? 
                '<span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">REQUIRED</span>' : 
                '<span class="bg-green-500 text-white text-xs px-2 py-1 rounded-full">OPTIONAL</span>';

            return `
                <div class="app-card bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-${metadata.color}-500 to-${metadata.color}-600 p-6 text-white">
                        <div class="flex items-center justify-between mb-3">
                            <i class="fas ${metadata.icon} text-4xl"></i>
                            <span class="version-badge bg-white text-${metadata.color}-600 px-3 py-1 rounded-full font-bold">
                                v${app.version}
                            </span>
                        </div>
                        <h2 class="text-2xl font-bold mb-1">${app.app_name}</h2>
                        <p class="text-${metadata.color}-100 text-sm">${metadata.tagline}</p>
                    </div>
                    
                    <div class="p-6">
                        <p class="text-gray-600 mb-4">${metadata.description}</p>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas ${platformIcon} w-5"></i>
                                <span class="ml-2">${app.platform.charAt(0).toUpperCase() + app.platform.slice(1)}</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-calendar w-5"></i>
                                <span class="ml-2">${releaseDate}</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-file w-5"></i>
                                <span class="ml-2">${fileSizeMB} MB</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-code-branch w-5"></i>
                                <span class="ml-2">Build ${app.build_number}</span>
                            </div>
                        </div>

                        ${app.release_notes ? `
                            <div class="bg-gray-50 rounded-lg p-3 mb-4">
                                <p class="text-sm font-semibold text-gray-700 mb-1">What's New:</p>
                                <p class="text-sm text-gray-600">${app.release_notes}</p>
                            </div>
                        ` : ''}

                        <div class="flex items-center justify-between">
                            ${mandatoryBadge}
                            <a href="${app.file_url}" 
                               class="bg-${metadata.color}-600 hover:bg-${metadata.color}-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors flex items-center"
                               download>
                                <i class="fas fa-download mr-2"></i>
                                Download
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load updates on page load
        loadUpdates();
    </script>
</body>
</html>
